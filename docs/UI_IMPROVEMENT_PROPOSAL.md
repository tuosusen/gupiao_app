# スクリーニング画面UI改善提案

## 現状の問題点

### 1. 複雑すぎる条件設定
- 条件が多すぎて初心者には難しい
- どの条件を選べばいいか分からない
- スクリーニングモードが複数あり混乱する

### 2. 結果表示の見づらさ
- 列が多すぎてスクロールが必要
- 重要な情報が埋もれている
- 色分けやビジュアル化が不足

### 3. ワークフロー効率の問題
- スクリーニング → 詳細分析への遷移が不便
- 条件の保存・再利用ができない
- 結果の比較が困難

---

## 改善提案

### A. プリセットベースのスクリーニング ⭐⭐⭐

**目的**: 初心者でも簡単に使えるワンクリックスクリーニング

#### 実装案

```python
SCREENING_PRESETS = {
    "高配当・安定配当": {
        "icon": "💰",
        "description": "配当利回り4%以上、配当が安定している銘柄",
        "conditions": {
            "min_dividend_yield": 4.0,
            "max_dividend_cv": 0.3,
            "min_quality_score": 60,
            "risk_level": ["低リスク", "中リスク"]
        }
    },
    "配当貴族候補": {
        "icon": "👑",
        "description": "長期連続増配が見込まれる優良銘柄",
        "conditions": {
            "min_avg_yield": 3.0,
            "dividend_trend": "増加",
            "min_quality_score": 70,
            "max_per": 15
        }
    },
    "バリュー高配当": {
        "icon": "📊",
        "description": "割安かつ高配当な銘柄",
        "conditions": {
            "min_dividend_yield": 3.5,
            "max_per": 12,
            "max_pbr": 1.0,
            "min_quality_score": 50
        }
    },
    "超高配当": {
        "icon": "🚀",
        "description": "配当利回り5%以上（リスク高め）",
        "conditions": {
            "min_dividend_yield": 5.0,
            "min_quality_score": 40
        }
    },
    "安定成長配当": {
        "icon": "🌱",
        "description": "配当成長と安定性のバランス",
        "conditions": {
            "min_dividend_yield": 2.5,
            "dividend_trend": "増加",
            "max_dividend_cv": 0.25,
            "min_quality_score": 65
        }
    }
}
```

#### UI表示イメージ

```
┌─────────────────────────────────────────────────┐
│  🎯 おすすめスクリーニング                       │
├─────────────────────────────────────────────────┤
│                                                 │
│  💰 高配当・安定配当                 [選択]     │
│  配当利回り4%以上、配当が安定している銘柄        │
│                                                 │
│  👑 配当貴族候補                     [選択]     │
│  長期連続増配が見込まれる優良銘柄               │
│                                                 │
│  📊 バリュー高配当                   [選択]     │
│  割安かつ高配当な銘柄                          │
│                                                 │
│  🚀 超高配当                        [選択]     │
│  配当利回り5%以上（リスク高め）                │
│                                                 │
│  🌱 安定成長配当                     [選択]     │
│  配当成長と安定性のバランス                    │
│                                                 │
│  ⚙️  カスタム条件                    [詳細]     │
│  自分で条件を設定する                          │
└─────────────────────────────────────────────────┘
```

---

### B. 2段階UI（シンプル ⇄ 詳細） ⭐⭐⭐

#### シンプルモード（初心者向け）

```
┌─────────────────────────────────────┐
│ 🔍 銘柄スクリーニング                │
├─────────────────────────────────────┤
│                                     │
│ 目標配当利回り                       │
│ ━━━━●━━━━━━━━━━ 4.0%             │
│ 1%        5%        10%             │
│                                     │
│ リスク許容度                         │
│ ○ 低  ● 中  ○ 高                   │
│                                     │
│ 市場                                │
│ ● 日本株  ○ 米国株                  │
│                                     │
│      [スクリーニング実行]            │
│                                     │
│      詳細条件を表示 ▼               │
└─────────────────────────────────────┘
```

#### 詳細モード（上級者向け）

```
┌─────────────────────────────────────┐
│ 📊 配当条件                         │
│ ├ 最低配当利回り: [4.0] %          │
│ ├ 最大配当CV: [0.3]                │
│ ├ 配当トレンド: [増加▼]            │
│ └ 品質スコア: [60]以上             │
│                                     │
│ 💹 バリュエーション                │
│ ├ 最大PER: [15]                    │
│ ├ 最大PBR: [1.5]                   │
│ └ 時価総額: [100]億円以上          │
│                                     │
│ ⚠️  リスク指標                      │
│ ├ 自己資本比率: [40]%以上          │
│ ├ 流動比率: [100]%以上             │
│ └ リスクレベル: [☑低 ☑中 ☐高]    │
│                                     │
│      [スクリーニング実行]            │
│      シンプル表示に戻る ▲           │
└─────────────────────────────────────┘
```

---

### C. 結果表示の改善 ⭐⭐⭐

#### 1. カラーコーディング

```python
def get_yield_color(yield_value):
    """配当利回りに応じた色を返す"""
    if yield_value >= 5.0:
        return "🟢"  # 非常に高い
    elif yield_value >= 3.5:
        return "🟡"  # 高い
    elif yield_value >= 2.0:
        return "🟠"  # 普通
    else:
        return "⚪"  # 低い

def get_risk_badge(risk_level):
    """リスクレベルのバッジを返す"""
    badges = {
        "低リスク": "✅ 安全",
        "中リスク": "⚠️ 注意",
        "高リスク": "🔴 警戒",
        "非常に高リスク": "❌ 危険"
    }
    return badges.get(risk_level, "❓ 不明")
```

#### 2. コンパクト表示

**デフォルト表示（重要列のみ）**:
```
銘柄コード | 銘柄名    | 利回り | リスク | スコア | アクション
---------|----------|--------|--------|--------|------------
7203.T   | トヨタ    | 🟡 3.8%| ✅ 低  | 85/100 | [詳細]
8316.T   | 三井住友  | 🟢 5.2%| ⚠️ 中  | 72/100 | [詳細]
```

**展開表示（クリックで詳細）**:
```
銘柄コード | 銘柄名    | 利回り | リスク | スコア | アクション
---------|----------|--------|--------|--------|------------
7203.T   | トヨタ    | 🟡 3.8%| ✅ 低  | 85/100 | [詳細] ▼
         └─ PER: 12.5 | PBR: 0.9 | 自己資本比率: 45%
         └─ 5年平均: 3.5% | CV: 0.15 | トレンド: 増加
         └─ 配当性向: 32% | 時価総額: 35兆円
```

#### 3. ビジュアル化

```python
# スコアメーター表示
def render_score_gauge(score):
    """スコアをゲージ表示"""
    return f"""
    <div style="display: flex; align-items: center;">
        <div style="width: 100px; height: 20px; background: #e0e0e0; border-radius: 10px;">
            <div style="width: {score}%; height: 100%; background:
                 {'#4CAF50' if score >= 70 else '#FFC107' if score >= 50 else '#F44336'};
                 border-radius: 10px;"></div>
        </div>
        <span style="margin-left: 10px;">{score}/100</span>
    </div>
    """

# ミニチャート表示
def render_mini_chart(dividends_history):
    """配当トレンドのミニチャート"""
    fig = go.Figure()
    fig.add_trace(go.Scatter(
        x=list(range(len(dividends_history))),
        y=dividends_history,
        mode='lines',
        line=dict(width=2),
        showlegend=False
    ))
    fig.update_layout(
        height=50,
        margin=dict(l=0, r=0, t=0, b=0),
        xaxis=dict(visible=False),
        yaxis=dict(visible=False)
    )
    return fig
```

---

### D. フィルターとソート機能強化 ⭐⭐

#### インタラクティブフィルター

```python
# Streamlit実装例
col1, col2, col3 = st.columns(3)

with col1:
    sector_filter = st.multiselect(
        "セクターでフィルタ",
        options=["金融", "情報通信", "電気・ガス", "不動産", "その他"],
        default=[]
    )

with col2:
    yield_range = st.slider(
        "配当利回り範囲",
        min_value=0.0,
        max_value=10.0,
        value=(2.0, 8.0),
        step=0.5
    )

with col3:
    sort_by = st.selectbox(
        "並び替え",
        ["配当利回り（高）", "配当利回り（低）", "スコア（高）",
         "時価総額（大）", "リスク（低）"]
    )
```

---

### E. クイック比較機能 ⭐⭐

```
┌─────────────────────────────────────────────────┐
│  比較リスト（最大5銘柄）                         │
├─────────────────────────────────────────────────┤
│  ☑ 7203.T トヨタ        [削除]                  │
│  ☑ 8316.T 三井住友      [削除]                  │
│  ☑ 9434.T ソフトバンク  [削除]                  │
│                                                 │
│         [比較表を表示]                           │
└─────────────────────────────────────────────────┘

比較表:
項目          | トヨタ  | 三井住友 | ソフトバンク
-------------|---------|---------|-------------
配当利回り    | 3.8%    | 5.2%    | 6.1%
リスク        | 低      | 中      | 高
品質スコア    | 85      | 72      | 58
PER          | 12.5    | 8.3     | 15.2
自己資本比率  | 45%     | 8%      | 18%
```

---

### F. 条件保存・読み込み ⭐

```python
# セッション状態に保存
if st.button("この条件を保存"):
    saved_conditions = {
        "name": st.text_input("条件名を入力"),
        "conditions": {
            "min_dividend_yield": min_dividend_yield,
            "max_per": max_per,
            # ... その他の条件
        },
        "saved_at": datetime.now()
    }
    st.session_state["saved_conditions"].append(saved_conditions)
    st.success("保存しました！")

# 保存した条件を読み込み
saved_list = st.selectbox(
    "保存した条件を読み込む",
    options=[c["name"] for c in st.session_state.get("saved_conditions", [])]
)
```

---

### G. データベーススクリーニングの高速化表示 ⭐⭐

```python
# 進捗表示
progress_bar = st.progress(0)
status_text = st.empty()

total_stocks = len(stock_list)
for idx, stock in enumerate(stock_list):
    # スクリーニング処理
    process_stock(stock)

    # 進捗更新
    progress = (idx + 1) / total_stocks
    progress_bar.progress(progress)
    status_text.text(f"処理中: {idx + 1}/{total_stocks} ({progress*100:.1f}%)")

status_text.text("✅ スクリーニング完了！")
```

---

## 実装優先順位

### 最優先（すぐに実装）⭐⭐⭐
1. プリセットベーススクリーニング
2. カラーコーディング（利回り・リスク）
3. コンパクト表示（重要列のみ）

### 高優先（次期バージョン）⭐⭐
4. 2段階UI（シンプル/詳細）
5. インタラクティブフィルター
6. クイック比較機能

### 中優先（将来機能）⭐
7. 条件保存・読み込み
8. ビジュアル化（ミニチャート）
9. 進捗表示の改善

---

## UI/UXの原則

### 1. シンプル優先
- デフォルトはシンプルモード
- 詳細は必要な人だけが見る

### 2. ビジュアル化
- 数字だけでなく、色・アイコン・グラフを活用
- 一目で判断できるデザイン

### 3. 段階的開示
- 初期表示は最小限
- クリックで詳細を展開

### 4. 高速レスポンス
- データベーススクリーニングを推奨
- 進捗表示でユーザーを不安にさせない

### 5. プリセット活用
- 初心者はプリセットから始める
- 上級者はカスタム条件を使う

---

## まとめ

**すぐに実装すべき改善（今週中）**:
1. プリセットスクリーニング5種類追加
2. 結果表示のカラーコーディング
3. デフォルト列の絞り込み（5-7列）

**次のステップ（来週）**:
4. シンプル/詳細モード切り替え
5. インタラクティブフィルター
6. 比較リスト機能

**長期的改善**:
7. 条件保存機能
8. ビジュアルチャート統合
9. モバイル対応

これらの改善により、初心者から上級者まで使いやすいスクリーニングツールになります。
